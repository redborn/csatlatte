<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="student.connection">
	
	<resultMap type="YmdCountVo" id="YmdCountVoMap">
		<result column="hour" property="hour"/>
		<result column="count_connection" property="count"/>
	</resultMap>
	
	<resultMap type="YmCountVo" id="YmCountVoMap">
		<result column="day" property="day"/>
		<result column="count_connection" property="count"/>
	</resultMap>

	<resultMap type="YearCountVo" id="YearCountVoVoMap">
		<result column="month" property="month"/>
		<result column="count_connection" property="count"/>
	</resultMap>

	<select id="selectListCountYmd" parameterType="String" resultMap="YmdCountVoMap">
		SELECT CAST(DATE_FORMAT(connection_date, '%H') AS SIGNED) as hour,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE connection_date &gt;= DATE_FORMAT(#{ymd}, '%Y-%m-%d')
		   AND connection_date &lt; DATE_ADD(DATE_FORMAT(#{ymd}, '%Y-%m-%d'), INTERVAL 1 day)
		 GROUP BY DATE_FORMAT(connection_date, '%H') 
	</select>
	
	<select id="selectListCountYm" parameterType="String" resultMap="YmCountVoMap">
		SELECT CAST(DATE_FORMAT(connection_date, '%d') AS SIGNED) as day,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE connection_date &gt;= DATE_FORMAT(CONCAT(#{ym},'01'), '%Y-%m-%d')
		   AND connection_date &lt; DATE_ADD(DATE_FORMAT(CONCAT(#{ym},'01'), '%Y-%m-%d'), INTERVAL 1 month)
		 GROUP BY DATE_FORMAT(connection_date, '%d') 
	</select>
	
	<select id="selectListCountYear" parameterType="String" resultMap="YearCountVoMap">
		SELECT CAST(DATE_FORMAT(connection_date, '%m') AS SIGNED) as month,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE connection_date &gt;= DATE_FORMAT(CONCAT(#{year},'0101'), '%Y-%m-%d')
		   AND connection_date &lt; DATE_ADD(DATE_FORMAT(CONCAT(#{year},'0101'), '%Y-%m-%d'), INTERVAL 1 year)
		 GROUP BY DATE_FORMAT(connection_date, '%m') 
	</select>
	
</mapper>