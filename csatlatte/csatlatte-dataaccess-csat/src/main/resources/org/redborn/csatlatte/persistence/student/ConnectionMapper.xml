<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="student.connection">

	<resultMap type="StudentConnectionVo" id="StudentConnectionVoMap">
		<result column="hour" property="hour"/>
		<result column="day" property="day"/>
		<result column="month" property="month"/>
		<result column="count_connection" property="countConnection"/>
	</resultMap>

	<select id="selectListCountYmd" parameterType="String" resultMap="StudentConnectionVoMap">
		SELECT TO_CHAR(create_date, 'hh') as hour,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE connection_date &lt;= TO_DATE(#{ymd}, 'yyyymmdd')
		   AND connection_date + 1 &gt; TO_DATE(#{ymd}, 'yyyymmdd')
		 GROUP BY TO_CHAR(connection_date, 'hh') 
	</select>
	
	<select id="selectListCountYm" parameterType="String" resultMap="StudentConnectionVoMap">
		SELECT TO_CHAR(connection_date, 'dd') as day,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE TO_CHAR(connection_date, 'yyyymm') = #{ym}
		 GROUP BY TO_CHAR(connection_date, 'dd') 
	</select>
	
	<select id="selectListCountYear" parameterType="String" resultMap="StudentConnectionVoMap">
		SELECT TO_CHAR(connection_date, 'mm') as month,COUNT(student_seq) as count_connection
		  FROM csat_student_connection
		 WHERE TO_CHAR(connection_date, 'yyyy') = #{year}
		 GROUP BY TO_CHAR(connection_date, 'mm') 
	</select>
	
</mapper>